\documentclass[a4paper, 11pt, twoside, onecolumn, openany]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel} % English please
\usepackage{subfiles}
\usepackage{standalone}
\usepackage[a4paper, tmargin=2cm, rmargin = 2cm]{geometry}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{verbatim}
\definecolor{light-gray}{gray}{0.95} 
\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}


\usepackage[final]{microtype} % Less badboxes
\usepackage{color}
\usepackage{standalone}

\usepackage{amsmath,amssymb,mathtools,amsthm} % Math
\mathtoolsset{centercolon} %to make the colon and the equal sign in := on the same line
\title{Packing Boxes with Score Constraints}
\author{Asyl L. Hawa}
\date{\today}

\begin{document}
\maketitle
% example, n = 9, + extra box = 10
% add one more box with dominating vertices, i.e. score widths 70mm
% use indices, not actual score widths 
% sort scores in increasing order
% assign random mates, except dom vertices, they must be on the same box, assign them as mates to each other
% assign box widths except dominating box, doesn't need a width (doesn't get used)
% talk about MTGMA matchList vector
% talk about MIS - mateInduced vector - length of MIS
% talk about T-cycles FCA
% patch together - fullT vs split T
% final cycle, final path

\section{Example}
\subsection{Creating problem instance}
In this example, we will attempt to find a feasible alignment of nine boxes, with score widths ranging between 1mm and 70mm. The minimum score separation constraint, or ``threshold'', will be set at 70mm, the industry standard. 

Initially, we create 18 random values between 1 and 70, which will be our score widths. We also need to add an extra box with two score of widths 70mm, which will be our ``dominating scores'', giving us a total of $n$ = 10 boxes and 20 scores. These dominating scores will eventually be discarded. 

We then sort the scores in non-decreasing order, and place them in a vector. The scores will now be addressed by their indices throughout the rest of the algorithm (see Table \ref{table:allScores}). 

\begin{table}[htb]
\centering
\begin{tabular}{|l*{20}{|c}|}
	\hline
	Index & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 \\ \hline
	Scores & 3 & 4 & 12 & 22 & 25 & 35 & 36 & 37 & 38 & 45 & 49 & 54 & 54 & 55 & 55 & 64 & 65 & 66 & 70 & 70 \\
	\hline	
\end{tabular}
\caption{allScores vector.}
\label{table:allScores}
\end{table}

Since every box consists of two scores, each score is randomly assigned a ``mate'', so that one score (the smaller score) represents the left-hand side of the box, and the other score represents the right-hand side of the box. The only exceptions to the random allocation of mates are the dominating scores - they must be assigned to one another. We can then assign measurements to each pair of mates to represent the width of each individual box. %except dominating box, score not needed

\begin{table}[htb]
	\centering
	\begin{tabular}{|c|c|c|}
	\hline
	\multicolumn{2}{|c|}{Mates} & Box Width \\ \hline
	0 & 6 & 314 \\ \hline
	1 & 10 & 372 \\ \hline
	2 & 16 & 297 \\ \hline
	3 & 11 & 220 \\ \hline
	4 & 17 & 959 \\ \hline
	5 & 9 & 738 \\ \hline
	7 & 12 & 622 \\ \hline
	8 & 15 & 635 \\ \hline
	13 & 14 & 859 \\ \hline
	18 & 19 & 0 \\
	\hline
	\end{tabular}
	\caption{Mates.}
\end{table}	

Next, we create an adjaceny matrix. This adjaceny matrix contains information regarding threshold constraint. If the sum of two scores is greater than or equal to the threshold, the adjaceny matrix contains ``1'' in the relevant cell. If two scores are mates, the adjaceny matrix contains ``2''. Else, the adjaceny matrix contains ``0''. %change this, also explain that the adjMatrix is of size numScore x numScore, square matrix

\subsection{Matching scores}
Once we have created the problem instance, we then have to attempt to match the scores together. If two scores can be matched, it means that the boxes can be placed next to each other, and the total width of the two scores from the boxes is equal to or exceeds the threshold, and can therefore be scored using the knives in the scoring machine. 

The matching is performed as follows: starting from the smallest score (0), we attempt to match it with the largest possible score it is adjacent to ( = 1 in the adjaceny matrix), and that has not yet been matched (in this case, 19). We continue until all scores have been matched. If a score cannot be matched due to the largest score being its mate, we match the score with the second largest score available. As we can see in Table \ref{table:match}, score 7 was unable to be matched with the largest possible score, 12, as they are mates. Instead, 7 was matched with the next largest score, 11.

Once the matching algorithm is complete, we then examine the size of the matching list. For the instance to be feasible, all of the scores must be matched. If not all of the scores are matched, i.e. there are less than $n$ matchings in the matching list, then there are not enough matching edges to create a path, and the instance is infeasible. 

\begin{table}[htb]
	\centering
	\begin{tabular}{|c|c|}
		\hline
		\multicolumn{2}{|c|}{Match}\\ \hline
		0 & 19 \\ \hline
		1 & 18 \\ \hline
		2 & 17 \\ \hline
		3 & 16 \\ \hline
		4 & 15 \\ \hline
		5 & 14 \\ \hline
		6 & 13 \\ \hline
		7 & 11 \\ \hline
		8 & 12 \\ \hline
		9 & 10 \\
		\hline
	\end{tabular}
	\caption{Match List.}
	\label{table:match}
\end{table}	

\subsection{Mate-Induced Structure}
Now that we have a list of matched scores, we can now attempt to create an \textit{alternating cycle} which consists of an edge between scores that are mates, followed by an edge between scores that are matched. Therefore each score will either be preceded by a mate and followed by a match, or vice versa. The cycles are easily formed using the mate list and match list. 

If the mate-induced structure consists of only one cycle, then the instance is instantly feasible. In this example we have two cycles, and so we must find a way to connect, or ``patch'', these two cycles together to create a single cycle.


\begin{table}[htb]
	\centering
	\begin{tabular}{|l*{10}{|c}|}
		\hline
		Cycle 1 & 0 & 6 & 13 & 14 & 15 & 9 & 10 & 1 & 18 & 19 \\ \hline
		Cycle 2 & 2 & 16 & 3 & 11 & 7 & 12 & 8 & 15 & 4 & 17 \\
		\hline
	\end{tabular}
	\caption{Mate-induced structure consisting of two cycles.}	
\end{table}

\subsection{FCA}%change this title
In order to join these two cycles together to create a single cycle, we must find scores from different cycles that are able to be matched, i.e the sum of the scores are greater than or equal to the threshold. If we are able to find such scores, then we simply remove the old matches, and add the new ones. In this case, there are three possible sets of scores that can be used to connect the cycles together. For simplicity and speed, we choose the first set of scores found. This is depicted in FIGURE.
 

\begin{table}[htb]
	\centering
	\begin{tabular}{c|c|}
		\cline{2-2}
		& Scores \\ \hline
		\multicolumn{1}{|c|}{Cycle 1} & 1 - 18 - 2 - 17 \\ \hline
		\multicolumn{1}{|c|}{Cycle 2} & 4 - 15 - 5 - 14 \\ \hline
		\multicolumn{1}{|c|}{Cycle 3} & 6 - 13 - 8 - 12 \\
		\hline
	\end{tabular}
	\caption{T-Matrix.}
\end{table}	


\begin{figure}[htb]
	\centering
	\includestandalone[width=0.9\textwidth]{patch}
	\caption{Patching MIS blue = mates, red = matching, explain dotted lines.}	
\end{figure}

Now that the cycle has been formed, we simply remove the dominating scores, and obtain a single path.\\
\\
\code{Complete Path: 0 6 13 14 5 9 10 1 17 4 15 8 12 7 11 3 16 2}\\
\code{Order of Boxes: 1 9 6 -2 -5 -8 -7 -4 -3}\\
\code{Total Length of Path: 5043 millimeters.}





\begin{figure}[htb]
	\centering
	\includestandalone[width=0.6\textwidth]{boxes}
	\caption{Individual boxes.}	
\end{figure}



\begin{figure}[htb]
	\centering
	\includestandalone[width=\textwidth]{path}
	\caption{Final feasible alignment of boxes.}	
\end{figure}


\begin{comment}
\begin{table}[htb]
\centering
\begin{tabular}{c|c|c|c|c|}
\cline{2-5}
& \multicolumn{4}{|c|}{Scores} \\ \hline
\multicolumn{1}{|c|}{cycle 1} & 1 & 18 & 2 & 17 \\ \hline
\multicolumn{1}{|c|}{cycle 2} & 4 & 15 & 5 & 14 \\ \hline
\multicolumn{1}{|c|}{cycle 3} & 6 & 13 & 8 & 12 \\
\hline
\end{tabular}
\caption{T-Matrix.}
\end{table}	
\end{comment}



\begin{comment}
\begin{table}[htb]
\centering
\begin{tabular}{c|c|c|}
\cline{2-3}
& \multicolumn{2}{|c|}{Edges} \\ \hline
\multicolumn{1}{|c|}{cycle 1} & 1 & 2 \\ \hline
\multicolumn{1}{|c|}{cycle 2} & 4 & 5 \\ \hline
\multicolumn{1}{|c|}{cycle 3} & 6 & 8 \\
\hline
\end{tabular}
\caption{T-Matrix.}
\end{table}	
\end{comment}






\end{document}
