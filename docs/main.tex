\documentclass[a4paper, 11pt, twoside, onecolumn, openany]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel} % English please
\usepackage{subfiles}
\usepackage{standalone}
\usepackage[a4paper, tmargin=2cm, rmargin = 2cm]{geometry}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{verbatim}
\definecolor{light-gray}{gray}{0.95} 
\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}


\usepackage[final]{microtype} % Less badboxes
\usepackage{color}
\usepackage{standalone}

\usepackage{amsmath,amssymb,mathtools,amsthm} % Math
\mathtoolsset{centercolon} % to make the colon and the equal sign in := on the same line

\title{Packing Boxes with Score Constraints}
\author{Asyl L. Hawa}
\date{\today}

\begin{document}
\maketitle

\section{Example}
\subsection{Creating problem instance}
In this example, we will attempt to find a feasible alignment of nine boxes, with score widths ranging between 1mm and 70mm. The minimum score separation constraint, or ``threshold'', is the minimum distance allowed between two scores from different boxes, and will be set at 70mm, the industry standard. 

Initially, we create 18 random values between 1 and 70, which will be our score widths. We also need to add an extra ``dominating box'' with two scores of widths 70mm, which will be our ``dominating scores'', giving us a total of $n$ = 10 boxes and 20 scores. These dominating scores will eventually be discarded. 

We then sort the scores in non-decreasing order, and place them in a vector. The scores will now be addressed by their indices throughout the rest of the algorithm (see Table \ref{table:allScores}). 

\begin{table}[!htb]
\centering
\begin{tabular}{|l*{20}{|c}|}
	\hline
	Index & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 \\ \hline
	Scores & 3 & 4 & 12 & 22 & 25 & 35 & 36 & 37 & 38 & 45 & 49 & 54 & 54 & 55 & 55 & 64 & 65 & 66 & 70 & 70 \\
	\hline	
\end{tabular}
\caption{allScores vector.}
\label{table:allScores}
\end{table}

Since every box consists of two scores, each score is randomly assigned a ``mate'', so that one score (the smaller score) represents the left-hand side of the box, and the other score represents the right-hand side of the box. Therefore, each pair of mates represents a box. The only exceptions to the random allocation of mates are the dominating scores - they must be assigned to one another. We can then assign measurements to each pair of mates to represent the width of each individual box. Note that we do not assign a box width to the dominating box, as it will not be used in the final solution. 

\begin{table}[!htb]
	\centering
	\begin{tabular}{|c|c|c|c|}
	\hline
	Box & \multicolumn{2}{|c|}{Scores} & Box Width \\ \hline
	1 & 0 & 6 & 341 \\ \hline
	2 & 1 & 10 & 372 \\ \hline
	3 & 2 & 16 & 297 \\ \hline
	4 & 3 & 11 & 220 \\ \hline
	5 & 4 & 17 & 959 \\ \hline
	6 & 5 & 9 & 738 \\ \hline
	7 & 7 & 12 & 622 \\ \hline
	8 & 8 & 15 & 635 \\ \hline
	9 & 13 & 14 & 859 \\ \hline
	10 & 18 & 19 & 0 \\
	\hline
	\end{tabular}
	\caption{Mates.}
	\label{table:mates}
\end{table}	

Figure \ref{fig:boxes} shows the individual boxes with their respective score widths and box number. The box number will be used in the final solution to show the order in which the boxes should be placed.

\begin{figure}[!htb]	
	\centering
	\includestandalone[width=0.6\textwidth]{boxes}
	\caption{Individual boxes.}	
	\label{fig:boxes}
\end{figure}

We then create an adjacency matrix, which contains information regarding which pairs of scores meet the minimum score separation constraint, as well as which pairs of scores are mates.

We can also depict this problem graphically (Figure \ref{fig:threshold}) by representing each score as a vertex with an assigned value corresponding to the score width. A red edge between two vertices shows that the scores meet the minimum score separation constraint, and can be feasibly matched, and a blue edge between two vertices shows that the corresponding scores are mates, and therefore represent a box. 



\begin{figure}[!htb]
	\centering
	\includestandalone[width=0.5\textwidth]{thresholdgraph}
	\caption{Threshold graph.}
	\label{fig:threshold}	
\end{figure}



\subsection{Matching scores}
Once we have created the problem instance, we then have to attempt to match the scores together. If two scores can be matched, it means that the boxes can be placed next to each other, and the total width of the two scores from the boxes is equal to or exceeds the threshold, and can therefore be scored using the knives in the scoring machine. 

We already have a list of all the scores that any one score is adjacent to. For each score $u$, we now have to choose just one score $v$ that score $u$ will be matched with. Starting from the smallest score, we use the adjacent matrix to match each score to the largest possible score available. If a score $u$ cannot be matched with the largest possible score $v$, due to $v$ being $u$'s mate, we instead match $u$ with the second largest score available. As we can see in Table \ref{table:match}, score 7 was unable to be matched with the largest possible score, 12, as they are mates. Instead, 7 was matched with the next largest score, 11.

\begin{table}[!htb]
	\centering
	\begin{tabular}{|l*{20}{|c}|}
		\hline
		Score & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 & 15 & 16 & 17 & 18 & 19 \\ \hline
		Match & 19 & 18 & 17 & 16 & 15 & 14 & 13 & 11 & 12 & 10 & 9 & 7 & 8 & 6 & 5 & 4 & 3 & 2 & 1 & 0 \\
		\hline	
	\end{tabular}
	\caption{Match list.}
	\label{table:match}
\end{table}

Once the matching algorithm is complete, each score should be associated with exactly two other scores: its mate, and its match. For the instance to be feasible, all of the scores must be matched. If there are one or more scores that are unmatched, the instance is immediately infeasible.

Graphically, as depicted in Figure \ref{fig:match}, if the instance is feasible, each vertex will be adjacent to two other vertices via two edges of different colours, one red edge, and one blue edge. The resulting graph is a 2-regular graph.


\begin{figure}[!htb]
	\centering
	\includestandalone[width=0.45\textwidth]{matchgraph}
	\caption{Match graph.}
	\label{fig:match}	
\end{figure}

\subsection{Mate-Induced Structure}
Now that we have a list of matched scores, we can now attempt to create an \textit{alternating cycle}, which is a cycle consisting of edges of alternating colours. In other words, the cycle will consist of an edge between scores that are mates, followed by an edge between scores that are matched. Therefore, each score will either be preceded by a mate and followed by a match, or vice versa. The cycles are easily formed using the mate list and match list, and are collectively called the mate-induced structure.

\begin{table}[!htb]
	\centering
	\begin{tabular}{|l*{10}{|c}|}
		\hline
		Cycle 1 & 0 & 6 & 13 & 14 & 15 & 9 & 10 & 1 & 18 & 19 \\ \hline
		Cycle 2 & 2 & 16 & 3 & 11 & 7 & 12 & 8 & 15 & 4 & 17 \\
		\hline
	\end{tabular}
	\caption{Mate-induced structure consisting of two cycles.}	
	\label{table:mis}
\end{table}

If the mate-induced structure consists of only one cycle, then the instance is instantly feasible. We simply remove the dominating vertices and obtain a feasible alignment of the boxes. In this example we have two cycles, and so we must find a way to connect, or ``patch'', these two cycles together to create a single cycle.




\begin{figure}[!htb]
	\centering
	\includestandalone[width=0.9\textwidth]{mis}
	\caption{MIS.}
	\label{fig:mis}	
\end{figure}



\subsection{Connecting cycles}%change this title
In order to join these two cycles together to create a single cycle, we must find scores from different cycles that are able to be matched. If we are able to find such scores, then we simply remove the old matching edges, and add the new ones. In this case, we can use the edges $\{1,18\}$ and $\{2,17\}$, which are from different cycles. Score 1 can be feasibly matched with score 17, and score 2 can be feasibly matched with score 18. Therefore, we remove the original edges $\{1,18\}$, $\{2,17\}$, and create two new edges, $\{1,17\}$ and $\{2,18\}$. The two cycles have now been connect to create a single cycle, as shown in Figure \ref{fig:patch}.
 


\begin{figure}[!htb]
	\centering
	\includestandalone[width=0.9\textwidth]{patch}
	\caption{Patching MIS blue = mates, red = matching, explain dotted lines.}
	\label{fig:patch}	
\end{figure}


Now that we have a single alternating cycle containing all of the scores, we can remove the dominating scores, and obtain a feasible solution to the problem. The final feasible alignment of the boxes is shown in Figure \ref{fig:path}.


\begin{figure}[!htb]
	\centering
	\includestandalone[width=\textwidth]{path}
	\caption{Final feasible alignment of boxes.}	
	\label{fig:path}
\end{figure}

\section{Output}
Becker's original algorithm was designed to output a statement of feasibility or infeasibility for a large number of instances. This is useful to test the efficiency of the algorithm, but it does not allow a user to obtain an explicit solution for any given instance. In Becker's algorithm, he determines whether the cycles of the mate-induced structure can be connected, and if so, outputs a statement of feasibility - his program does not actually proceed to connect the cycles together. I have extended the program, and created functions that connect the cycles together, removes the dominating scores, and outputs the scores and box numbers in the order that will produce a feasible alignment of the boxes. The output corresponding to the above example is as follows:\\
\\
\code{Complete Path: 0 6 13 14 5 9 10 1 17 4 15 8 12 7 11 3 16 2}\\
\code{Order of Boxes: 1 9 6 -2 -5 -8 -7 -4 -3}\\
\code{Total Length of Path: 5043 millimeters.}\\

If the box is aligned in its original form, i.e. with the smallest score on the left-hand side, the box number in the \texttt{Order of Boxes} output is positive. If the box needs to be rotated in the alignment, i.e. with the smallest score on the right-hand side, the box number is negative. This immediately provides the user with the information required to form a feasible alignment of the boxes.

\section{Packing}

One of the algorithms currently implemented into the program packs the boxes into strips by aligning each score next to the smallest possible score avaialable. Each strip is packed in turn, and the box with the smallest score that has not yet been packed is the first to be placed at the beginning of the strip. We then search through the list of remaining scores in non-decreasing order to find the smallest score that can be feasibly placed next to the score at the end of the first strip, and whose corresponding box width fits onto the strip. If such a box is found, we add it to the strip, and repeat. Once the first strip is fully packed, either because there are no scores that meet the minimum score separation constraint, or because the remaining box widths cannot fit onto the strip, we move onto the next strip. This continues until all of the boxes have been packed. 

There are also functions that perform best-fit, first-fit, or next-fit algorithms on box widths sorted in both increasing and decreasing order of widths.


\section{Improvements}
\begin{itemize}
	\item Becker used arrays and set a specific size for each one - wastes memory and is inefficient. Instead I used vectors that could be expanded as required.
	\item Becker's code only evaluates whether a specific instance is feasible or infeasible. My code now outputs a solution to an instance in full, including the following:
	\begin{itemize}
		\item Outputs final solution with score indices in order.
		\item Outputs final solution with score widths in millimeters in order.
		\item Outputs box widths in millimeters in order.
		\item Outputs box number in order: if the number is positive, then the box's orientation is ``regular'' (the smallest score width is on the left-hand side), and if the number is negative, then the box's orientation is ``rotated'' (the smallest score is on the right-hand side).
		\item Outputs the total length of the boxes in millimeters.
	\end{itemize}
	\item All methods in the algorithm are now in separate functions, which makes the code easier to read and edit.
	\item The code determines whether only one T-cycle is required to connect all the cycles together, or whether multiple T-cycles are required. 
	\item Box widths have now been added - each box has a width in millimeters.
	\item User input - users can create a simple text file containing score width, mates and box widths to use with the program.
	
	
	
\end{itemize}


\begin{comment}
\begin{table}[!htb]
\centering
\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{Match}\\ \hline
0 & 19 \\ \hline
1 & 18 \\ \hline
2 & 17 \\ \hline
3 & 16 \\ \hline
4 & 15 \\ \hline
5 & 14 \\ \hline
6 & 13 \\ \hline
7 & 11 \\ \hline
8 & 12 \\ \hline
9 & 10 \\
\hline
\end{tabular}
\caption{Match List.}
%\label{table:match}
\end{table}	
\end{comment}


\begin{comment}
\begin{table}[!htb]
\centering
\begin{tabular}{c|c|}
\cline{2-2}
& Scores \\ \hline
\multicolumn{1}{|c|}{Cycle 1} & 1 - 18 - 2 - 17 \\ \hline
\multicolumn{1}{|c|}{Cycle 2} & 4 - 15 - 5 - 14 \\ \hline
\multicolumn{1}{|c|}{Cycle 3} & 6 - 13 - 8 - 12 \\
\hline
\end{tabular}
\caption{T-Matrix.}
\label{table:tcycles}
\end{table}	
\end{comment}







\end{document}
